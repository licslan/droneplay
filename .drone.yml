kind: pipeline
name: licslan

steps:
- name: Maven编译打包
  image: maven:3-jdk-8
  volumes:
  - name: cache
    path: /root/.m2
  commands:
    - echo "hello docker"
    - mvn clean install


- name: 制作镜像
  image: docker:dind
  volumes:
  - name: dockersock
    path: /var/run
  commands:
  - sleep 5 # give docker enough time to start
  - docker ps -a
  - docker build -t springio/gs-spring-boot-docker:v1 .

- name: 运行镜像
  image: springio/gs-spring-boot-docker
  commands:
     - docker run -it -d --name springboot -p 7777:8080 springio/gs-spring-boot-docker

services:
- name: docker
  image: docker:dind
  privileged: true
  volumes:
  - name: dockersock
    path: /var/run

volumes:
- name: dockersock
  temp: {}


  when:
    event:
    - push

